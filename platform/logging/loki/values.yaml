# Loki (lightweight, single-node) for K3s on small instances
# - SingleBinary mode
# - Local filesystem storage (no S3)
# - Disable caches + canary to save RAM
# - No persistence for now (easy); enable later once stable

loki:
  auth_enabled: false

  # Single node => no replication needed
  commonConfig:
    replication_factor: 1

  storage:
    type: filesystem

  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

deploymentMode: SingleBinary

singleBinary:
  replicas: 1
  resources:
    requests:
      cpu: 50m
      memory: 256Mi
    limits:
      cpu: 400m
      memory: 768Mi

# No persistence (for now). Turn on later once stable.
# singleBinary:
#   persistence:
#     enabled: true
#     size: 10Gi

# Avoid deploying extra microservices
read:
  replicas: 0
write:
  replicas: 0
backend:
  replicas: 0

test:
  enabled: false

# Loki service is internal-only; Grafana will access it inside the cluster
service:
  type: ClusterIP

# Keep it simple
gateway:
  enabled: false

# Disable caches (these create memcached StatefulSets that kill small nodes)
chunksCache:
  enabled: false
resultsCache:
  enabled: false

# Optional: disable canary (saves a pod)
lokiCanary:
  enabled: false

# Disable monitoring resources for now (optional)
monitoring:
  serviceMonitor:
    enabled: false
  rules:
    enabled: false
